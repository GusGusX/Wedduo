{% load static %}
{% load custom_tags %}
{% load tailwind_tags %}
<!DOCTYPE html>
<html lang="th"class="h-full bg-white">
{% tailwind_css %}

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</title>
    <link href="{% static 'css/output.css' %}" rel="stylesheet">

    <script>
        function viewTenant(roomNumber) {
            fetch(`/tenant-info/${roomNumber}/`)
                .then(response => response.json())
                .then(data => {
                    alert(`‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡πâ‡∏≠‡∏á ${roomNumber}:\n‡∏ä‡∏∑‡πà‡∏≠: ${data.name}\n‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠: ${data.phone}`);
                })
                .catch(error => console.error('Error:', error));
        }

        function bookRoom(roomNumber) {
            const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
            fetch(`/book-room/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrftoken,
                },
                body: JSON.stringify({ 'room_number': roomNumber })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert(`‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á ${roomNumber} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
                        location.reload();
                    } else {
                        alert(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á ${roomNumber} ‡πÑ‡∏î‡πâ: ${data.error}`);
                    }
                })
                .catch(error => console.error('Error:', error));
        }

        function editBooking(bookingId) {
            const newDate = prompt("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ô‡∏µ‡πâ (YYYY-MM-DD):");
            if (newDate) {
                const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                fetch(`/edit-booking/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': csrftoken,
                    },
                    body: JSON.stringify({ 'booking_id': bookingId, 'new_date': newDate })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert(`‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
                            location.reload();
                        } else {
                            alert(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÑ‡∏î‡πâ: ${data.error}`);
                        }
                    })
                    .catch(error => console.error('Error:', error));
            }
        }

        function loadNotifications() {
            fetch('/notifications/')
                .then(response => response.json())
                .then(data => {
                    const dropdownContent = document.querySelector('.notification-content');
                    dropdownContent.innerHTML = '';
                    data.notifications.forEach(notification => {
                        const notificationItem = document.createElement('div');
                        notificationItem.className = 'p-3 hover:bg-orange-50 cursor-pointer flex items-center space-x-3 transition-all transform hover:translate-x-1';
                        notificationItem.innerHTML =
                            `<span class="bg-blue-100 text-blue-600 p-2 rounded-full">üîî</span>
                            <span class="text-black">${notification.message}</span>`;
                        dropdownContent.appendChild(notificationItem);
                    });
                })
                .catch(error => console.error('Error loading notifications:', error));
        }

        function toggleDropdown() {
            const dropdown = document.getElementById('notification-dropdown');
            dropdown.classList.toggle('hidden');
            if (!dropdown.classList.contains('hidden')) {
                loadNotifications();
            }
        }

        function closeDropdown() {
            const dropdown = document.getElementById('notification-dropdown');
            dropdown.classList.add('hidden');
        }
    </script>

    <style>
        .profile-pic {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }
    </style>
</head>

<body class="bg-gray-100">
    <div class="p-6 min-h-screen">
        <div class="flex justify-between items-center bg-orange-500 p-4 text-white rounded-lg shadow-lg mb-6">
            <div class="text-lg font-bold">JKH Dormitory</div>
            <div class="relative flex items-center space-x-4">
                <button onclick="toggleDropdown()" class="bg-white p-2 rounded-full text-orange-500 shadow-md hover:bg-gray-100 transition-colors relative">üîî</button>
                <div id="notification-dropdown" class="absolute right-0 mt-8 w-64 bg-white rounded-lg shadow-lg hidden z-10 transition duration-200 ease-out transform scale-95 origin-top-right">
                    <div class="p-4 text-black font-semibold border-b bg-orange-100 rounded-t-lg">‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</div>
                    <div class="notification-content"></div>
                    <div class="border-t">
                        <button onclick="closeDropdown()" class="w-full p-2 text-white bg-red-500 hover:bg-red-600 rounded-b-lg transition-colors">‡∏õ‡∏¥‡∏î</button>
                    </div>
                </div>
                <div class="relative">
                    <a href="{% url 'profile' %}" class="absolute inset-0"></a>
                    <a href="{% url 'user_profile' %}">
                        <button class="bg-white p-2 rounded-full text-orange-500 shadow-md hover:bg-gray-100 transition-colors relative">
                            <img src="{% static 'images/profile.png' %}" alt="‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå" class="profile-pic">
                        </button>
                    </a>
                </div>
                <a class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-md shadow-md transition-colors" href="{% url 'user_login' %}">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
            </div>
        </div>

        <div class="mt-8">
            <h2 class="text-2xl font-bold mb-4">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å</h2>
            <table class="min-w-full bg-white rounded-lg shadow-lg">
                <thead>
                    <tr class="bg-orange-100 text-gray-600">
                        <th class="py-2 px-4">‡∏´‡πâ‡∏≠‡∏á</th>
                        <th class="py-2 px-4">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        <th class="py-2 px-4">‡∏£‡∏≤‡∏Ñ‡∏≤ / ‡∏ß‡∏±‡∏ô</th>
                        <th class="py-2 px-4">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody>
                    {% for room in rooms %}
                    <tr class="text-gray-600 hover:bg-orange-50 transition-colors">
                        <td class="py-2 px-4 font-semibold">{{ room.number }}</td>
                        <td class="py-2 px-4">{{ room.status|setstatus }}</td>
                        <td class="py-2 px-4">{{ room.price }} ‡∏ö‡∏≤‡∏ó</td>
                        <td class="py-2 px-4">
                            <a href="{% url 'book_room' %}?room_number={{ room.number }}" class="bg-yellow-500 text-white px-3 py-1 rounded-md hover:bg-yellow-400 transition-colors">‡∏à‡∏≠‡∏á</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <style>
            /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
            th, td {
                padding: 12px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏≤‡∏ô‡πÉ‡∏ô */
                text-align: left; /* ‡∏à‡∏±‡∏î‡πÅ‡∏ô‡∏ß‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
            }
            th {
                width: 20%; /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏´‡∏±‡∏ß */
            }
            td {
                width: 20%; /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• */
            }
        </style>

        <div class="mt-8">
            <h2 class="text-2xl font-bold mb-4">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</h2>
            <table class="min-w-full bg-white rounded-lg shadow-lg">
                <thead>
                    <tr class="bg-orange-100 text-gray-600">
                        <th class="py-2 px-4">‡∏´‡πâ‡∏≠‡∏á</th>
                        <th class="py-2 px-4">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á</th>
                        <th class="py-2 px-4">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
                        <th class="py-2 px-4">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody>
                    {% for booking in bookings %}
                    <tr class="text-gray-600 hover:bg-orange-50 transition-colors">
                        <td class="py-2 px-4 font-semibold">{{ booking.room.number }}</td>
                        <td class="py-2 px-4">{{ booking.date }}</td>
                        <td class="py-2 px-4">{{ booking.status }}</td>
                        <td class="py-2 px-4">
                            <button onclick="editBooking('{{ booking.id }}')" class="bg-blue-500 text-white px-3 py-1 rounded-md hover:bg-blue-400 transition-colors">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</body>

</html>